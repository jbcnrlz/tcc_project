(function(){var a=function(e,h){var d=1,l=2,m=4,A=8,p=/^\s*(\d+)((px)|\%)?\s*$/i,z=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,k=/^\d+px$/;var x=function(){var D=this.getValue(),C=this.getDialog(),B=D.match(p);if(B){if(B[2]=="%"){u(C,false)}D=B[1]}if(C.lockRatio){var E=C.originalElement;if(E.getCustomData("isReady")=="true"){if(this.id=="txtHeight"){if(D&&D!="0"){D=Math.round(E.$.width*(D/E.$.height))}if(!isNaN(D)){C.setValueOf("info","txtWidth",D)}}else{if(D&&D!="0"){D=Math.round(E.$.height*(D/E.$.width))}if(!isNaN(D)){C.setValueOf("info","txtHeight",D)}}}}r(C)};var r=function(B){if(!B.originalElement||!B.preview){return 1}B.commitContent(m,B.preview);return 0};function t(){var C=arguments;var B=this.getContentElement("advanced","txtdlgGenStyle");B&&B.commit.apply(B,C);this.foreach(function(D){if(D.commit&&D.id!="txtdlgGenStyle"){D.commit.apply(D,C)}})}var n;function y(B){if(n){return}n=1;var E=this.getDialog(),D=E.imageElement;if(D){this.commit(d,D);B=[].concat(B);var F=B.length,G;for(var C=0;C<F;C++){G=E.getContentElement.apply(E,B[C].split(":"));G&&G.setup(d,D)}}n=0}var u=function(G,I){if(!G.getContentElement("info","ratioLock")){return null}var E=G.originalElement;if(!E){return null}if(I=="check"){if(!G.userlockRatio&&E.getCustomData("isReady")=="true"){var C=G.getValueOf("info","txtWidth"),J=G.getValueOf("info","txtHeight"),F=E.$.width*1000/E.$.height,B=C*1000/J;G.lockRatio=false;if(!C&&!J){G.lockRatio=true}else{if(!isNaN(F)&&!isNaN(B)){if(Math.round(F)==Math.round(B)){G.lockRatio=true}}}}}else{if(I!==undefined){G.lockRatio=I}else{G.userlockRatio=1;G.lockRatio=!G.lockRatio}}var D=CKEDITOR.document.getById(j);if(G.lockRatio){D.removeClass("cke_btn_unlocked")}else{D.addClass("cke_btn_unlocked")}D.setAttribute("aria-checked",G.lockRatio);if(CKEDITOR.env.hc){var H=D.getChild(0);H.setHtml(G.lockRatio?CKEDITOR.env.ie?"\u25A0":"\u25A3":CKEDITOR.env.ie?"\u25A1":"\u25A2")}return G.lockRatio};var i=function(B,H){var I=B.originalElement,D=I.getCustomData("isReady")=="true";if(D){var G=B.getContentElement("info","txtWidth"),E=B.getContentElement("info","txtHeight"),F,C;if(H){F=0;C=0}else{F=I.$.width;C=I.$.height}G&&G.setValue(F);E&&E.setValue(C)}r(B)};var o=function(E,D){if(E!=d){return}function H(K,I){var J=K.match(p);if(J){if(J[2]=="%"){J[1]+="%";u(C,false)}return J[1]}return I}var C=this.getDialog(),F="",G=this.id=="txtWidth"?"width":"height",B=D.getAttribute(G);if(B){F=H(B,F)}F=H(D.getStyle(G),F);this.setValue(F)};var b;var w=function(){var C=this.originalElement,B=CKEDITOR.document.getById(s);C.setCustomData("isReady","true");C.removeListener("load",w);C.removeListener("error",g);C.removeListener("abort",g);if(B){B.setStyle("display","none")}if(!this.dontResetSize){i(this,e.config.image_prefillDimensions===false)}if(this.firstLoad){CKEDITOR.tools.setTimeout(function(){u(this,"check")},0,this)}this.firstLoad=false;this.dontResetSize=false;r(this)};var g=function(){var D=this.originalElement,C=CKEDITOR.document.getById(s);D.removeListener("load",w);D.removeListener("error",g);D.removeListener("abort",g);var B=CKEDITOR.getUrl(CKEDITOR.plugins.get("image").path+"images/noimage.png");if(this.preview){this.preview.setAttribute("src",B)}if(C){C.setStyle("display","none")}u(this,false)};var v=function(B){return CKEDITOR.tools.getNextId()+"_"+B},j=v("btnLockSizes"),q=v("btnResetSize"),s=v("ImagePreviewLoader"),c=v("previewLink"),f=v("previewImage");return{title:e.lang.image[h=="image"?"title":"titleButton"],minWidth:420,minHeight:360,onShow:function(){this.imageElement=false;this.linkElement=false;this.imageEditMode=false;this.linkEditMode=false;this.lockRatio=true;this.userlockRatio=0;this.dontResetSize=false;this.firstLoad=true;this.addLink=false;var F=this.getParentEditor(),H=F.getSelection(),E=H&&H.getSelectedElement(),G=E&&F.elementPath(E).contains("a",1),B=CKEDITOR.document.getById(s);if(B){B.setStyle("display","none")}b=new CKEDITOR.dom.element("img",F.document);this.preview=CKEDITOR.document.getById(f);this.originalElement=F.document.createElement("img");this.originalElement.setAttribute("alt","");this.originalElement.setCustomData("isReady","false");if(G){this.linkElement=G;this.linkEditMode=true;this.addLink=true;var D=G.getChildren();if(D.count()==1){var C=D.getItem(0);if(C.type==CKEDITOR.NODE_ELEMENT){if(C.is("img")||C.is("input")){this.imageElement=D.getItem(0);if(this.imageElement.is("img")){this.imageEditMode="img"}else{if(this.imageElement.is("input")){this.imageEditMode="input"}}}}}if(h=="image"){this.setupContent(l,G)}}if(this.customImageElement){this.imageEditMode="img";this.imageElement=this.customImageElement;delete this.customImageElement}else{if(E&&E.getName()=="img"&&!E.data("cke-realelement")||E&&E.getName()=="input"&&E.getAttribute("type")=="image"){this.imageEditMode=E.getName();this.imageElement=E}}if(this.imageEditMode){this.cleanImageElement=this.imageElement;this.imageElement=this.cleanImageElement.clone(true,true);this.setupContent(d,this.imageElement)}u(this,true);if(!CKEDITOR.tools.trim(this.getValueOf("info","txtUrl"))){this.preview.removeAttribute("src");this.preview.setStyle("display","none")}},onOk:function(){if(this.imageEditMode){var B=this.imageEditMode;if(h=="image"&&B=="input"&&confirm(e.lang.image.button2Img)){B="img";this.imageElement=e.document.createElement("img");this.imageElement.setAttribute("alt","");e.insertElement(this.imageElement)}else{if(h!="image"&&B=="img"&&confirm(e.lang.image.img2Button)){B="input";this.imageElement=e.document.createElement("input");this.imageElement.setAttributes({type:"image",alt:""});e.insertElement(this.imageElement)}else{this.imageElement=this.cleanImageElement;delete this.cleanImageElement}}}else{if(h=="image"){this.imageElement=e.document.createElement("img")}else{this.imageElement=e.document.createElement("input");this.imageElement.setAttribute("type","image")}this.imageElement.setAttribute("alt","")}if(!this.linkEditMode){this.linkElement=e.document.createElement("a")}this.commitContent(d,this.imageElement);this.commitContent(l,this.linkElement);if(!this.imageElement.getAttribute("style")){this.imageElement.removeAttribute("style")}if(!this.imageEditMode){if(this.addLink){if(!this.linkEditMode){e.insertElement(this.linkElement);this.linkElement.append(this.imageElement,false)}else{if(this.linkElement.equals(e.getSelection().getSelectedElement())){this.linkElement.setHtml("");this.linkElement.append(this.imageElement,false)}else{e.insertElement(this.imageElement)}}}else{e.insertElement(this.imageElement)}}else{if(!this.linkEditMode&&this.addLink){e.insertElement(this.linkElement);this.imageElement.appendTo(this.linkElement)}else{if(this.linkEditMode&&!this.addLink){e.getSelection().selectElement(this.linkElement);e.insertElement(this.imageElement)}}}},onLoad:function(){if(h!="image"){this.hidePage("Link")}var B=this._.element.getDocument();if(this.getContentElement("info","ratioLock")){this.addFocusable(B.getById(q),5);this.addFocusable(B.getById(j),5)}this.commitContent=t},onHide:function(){if(this.preview){this.commitContent(A,this.preview)}if(this.originalElement){this.originalElement.removeListener("load",w);this.originalElement.removeListener("error",g);this.originalElement.removeListener("abort",g);this.originalElement.remove();this.originalElement=false}delete this.imageElement},contents:[{id:"info",label:e.lang.image.infoTab,accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"txtUrl",type:"text",label:e.lang.common.url,required:true,onChange:function(){var D=this.getDialog(),E=this.getValue();if(E.length>0){D=this.getDialog();var C=D.originalElement;if(D.preview){D.preview.removeStyle("display")}C.setCustomData("isReady","false");var B=CKEDITOR.document.getById(s);if(B){B.setStyle("display","")}C.on("load",w,D);C.on("error",g,D);C.on("abort",g,D);C.setAttribute("src",E);if(D.preview){b.setAttribute("src",E);D.preview.setAttribute("src",b.$.src);r(D)}}else{if(D.preview){D.preview.removeAttribute("src");D.preview.setStyle("display","none")}}},setup:function(D,C){if(D==d){var B=C.data("cke-saved-src")||C.getAttribute("src");var E=this;this.getDialog().dontResetSize=true;E.setValue(B);E.setInitValue()}},commit:function(C,B){if(C==d&&(this.getValue()||this.isChanged())){B.data("cke-saved-src",this.getValue());B.setAttribute("src",this.getValue())}else{if(C==A){B.setAttribute("src","");B.removeAttribute("src")}}},validate:CKEDITOR.dialog.validate.notEmpty(e.lang.image.urlMissing)},{type:"button",id:"browse",style:"display:inline-block;margin-top:14px;",align:"center",label:e.lang.common.browseServer,hidden:true,filebrowser:"info:txtUrl"}]}]},{type:"hbox",widths:["55%","25%","20%"],children:[{id:"txtAlt",type:"text",label:e.lang.image.alt,accessKey:"T","default":"Legenda da Imagem",onChange:function(){r(this.getDialog())},setup:function(C,B){if(C==d){this.setValue(B.getAttribute("alt"))}},commit:function(C,B){if(C==d){if(this.getValue()||this.isChanged()){B.setAttribute("alt",this.getValue())}}else{if(C==m){B.setAttribute("alt",this.getValue())}else{if(C==A){B.removeAttribute("alt")}}}}},{id:"cmbAlign",requiredContent:"img{float}",type:"select",style:"width:110px",label:e.lang.common.align,"default":"left",items:[[e.lang.common.notSet,""],[e.lang.common.alignLeft,"left"],[e.lang.common.alignRight,"right"]],onChange:function(){r(this.getDialog());y.call(this,"advanced:txtdlgGenStyle")},setup:function(C,B){if(C==d){var D=B.getStyle("float");switch(D){case"inherit":case"none":D=""}!D&&(D=(B.getAttribute("align")||"").toLowerCase());this.setValue(D)}},commit:function(C,B){var D=this.getValue();if(C==d||C==m){if(D){B.setStyle("float",D)}else{B.removeStyle("float")}if(C==d){D=(B.getAttribute("align")||"").toLowerCase();switch(D){case"left":case"right":B.removeAttribute("align")}}}else{if(C==A){B.removeStyle("float")}}}},{type:"hbox",children:[{type:"select",id:"txtGenClass",requiredContent:"img(cke-xyz)",label:e.lang.common.cssClass,items:[["1/3","img-rensponsive col-md-4"],["1/2","img-rensponsive col-md-6"],["1/1","img-rensponsive col-md-12"]],"default":"",setup:function(C,B){if(C==d){this.setValue(B.getAttribute("class"))}},commit:function(C,B){if(C==d){if(this.getValue()||this.isChanged()){B.setAttribute("class",this.getValue())}}}}]}]}]},{id:"Upload",hidden:true,filebrowser:"uploadButton",label:e.lang.image.upload,elements:[{type:"file",id:"upload",label:"Szukaj pliku na swoim komputerze",style:"height:40px",size:38},{type:"fileButton",id:"uploadButton",filebrowser:"info:txtUrl",label:"Załaduj zdjęcie","for":["Upload","upload"]}]}]}};CKEDITOR.dialog.add("image",function(b){return a(b,"image")});CKEDITOR.dialog.add("imagebutton",function(b){return a(b,"imagebutton")})})();