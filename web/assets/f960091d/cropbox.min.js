"use strict";(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(a){var b=function(f,g){var g=g||a(f.imageBox),h={state:{},ratio:1,options:f,imageBox:g,thumbBox:g.find(f.thumbBox),spinner:g.find(f.spinner),image:new Image(),getDataURL:function(){var j=document.createElement("canvas"),l=this.getInfo();j.width=l.width;j.height=l.height;var k=j.getContext("2d");k.drawImage(this.image,0,0,l.sw,l.sh,l.dx,l.dy,l.dw,l.dh);var m=j.toDataURL("image/png");return m},getInfo:function(){var j={width:this.options.thumbWidth,height:this.options.thumbHeight,dim:g.css("background-position").split(" "),size:g.css("background-size").split(" ")};j.dx=parseInt(j.dim[0])-g.width()/2+j.width/2,j.dy=parseInt(j.dim[1])-g.height()/2+j.height/2,j.dw=parseInt(j.size[0]),j.dh=parseInt(j.size[1]),j.sh=parseInt(this.image.height),j.sw=parseInt(this.image.width);j.ratio=this.ratio;return j},zoomIn:function(){this.ratio*=1.1;d()},zoomOut:function(){this.ratio*=0.9;d()}},d=function(){var j=parseInt(h.image.width)*h.ratio;var l=parseInt(h.image.height)*h.ratio;var k=(g.width()-j)/2;var m=(g.height()-l)/2;g.css({"background-image":"url("+h.image.src+")","background-size":j+"px "+l+"px","background-position":k+"px "+m+"px","background-repeat":"no-repeat"})},i=function(j){j.stopImmediatePropagation();h.state.dragable=true;h.state.mouseX=j.clientX;h.state.mouseY=j.clientY},c=function(m){m.stopImmediatePropagation();if(h.state.dragable){var k=m.clientX-h.state.mouseX;var o=m.clientY-h.state.mouseY;var l=g.css("background-position").split(" ");var j=k+parseInt(l[0]);var n=o+parseInt(l[1]);g.css("background-position",j+"px "+n+"px");h.state.mouseX=m.clientX;h.state.mouseY=m.clientY}},e=function(j){j.stopImmediatePropagation();h.state.dragable=false};h.spinner.show();h.image.onload=function(){h.spinner.hide();d();g.bind("mousedown",i);g.bind("mousemove",c);a(window).bind("mouseup",e)};h.image.src=f.imgSrc;g.on("remove",function(){a(window).unbind("mouseup",e)});return h};jQuery.fn.cropbox=function(c){return new b(c,this)}}));